<!doctype html><html lang=zh><head><meta name=viewport content="width=device-width,initial-scale=1"><title>小程序 video 组件踩坑记录</title>
<meta charset=utf-8><meta name=description content='Ladder@需求是当滑动视窗口的时候，当上一个正在播放的视频消失在视窗的时候，滑动也暂停，将这个视频暂停，同时捕获页面内的视频，播放离顶部最近的视屏。
最开始我这里是做了一个判断进入页面的时候第一个视频自动播放
autoplay="{{key===0?true:false}}" 然后我们需要先做的就是点击播放视频的时候暂停另外一个视频的播放。这里我们需要用到wx.createVideoContext去创造video的实例，控制video的播放和暂停。
indexCurrent: "video_0",// 记录播放的下标 videoPlay(e) { //点击播放时触发 // 当点击其他video播放时让原来的video暂停 if (!this.data.indexCurrent) { this.setData({ indexCurrent: curIdx }); const videoContext = wx.createVideoContext(`${curIdx}`, this); //这里对应的视频id videoContext.play(); } else { // 有播放时先将prev暂停，再播放当前点击的current const videoContextPrev = wx.createVideoContext(`${this.data.indexCurrent}`, this); //this是在自定义组件下，当前组件实例的this，以操作组件内 video 组件 if (this.data.indexCurrent !== curIdx) { videoContextPrev.pause(); this.setData({ indexCurrent: curIdx }); const videoContextCurrent = wx.createVideoContext(curIdx, this); videoContextCurrent.play(); } } // 同时要把此时播放的视频记录下来 this.setData({ cover_msg: this.data.cover_msg });} 然后是去获取所有video的dom保存他们距离顶部的距离：
const query = wx.createSelectorQuery(); query.selectAll(&#39;.video-list&#39;).boundingClientRect(rect => { rect.'><meta name=author content="卢穗杰"><link rel=canonical href=https://woshidashuaibi-lsj.github.io/blog/video-caikeng/><meta name=google-site-verification content="xxx"><link rel=alternate type=application/rss+xml href=https://woshidashuaibi-lsj.github.io//index.xml title=lusuijie><script async src="https://www.googletagmanager.com/gtag/js?id=G-xxx"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-xxx",{anonymize_ip:!1})}</script><script async defer data-website-id=xxx src=https://xxx></script><meta property="og:title" content="小程序 video 组件踩坑记录"><meta property="og:description" content='需求是当滑动视窗口的时候，当上一个正在播放的视频消失在视窗的时候，滑动也暂停，将这个视频暂停，同时捕获页面内的视频，播放离顶部最近的视屏。
最开始我这里是做了一个判断进入页面的时候第一个视频自动播放
autoplay="{{key===0?true:false}}" 然后我们需要先做的就是点击播放视频的时候暂停另外一个视频的播放。这里我们需要用到wx.createVideoContext去创造video的实例，控制video的播放和暂停。
indexCurrent: "video_0",// 记录播放的下标 videoPlay(e) { //点击播放时触发 // 当点击其他video播放时让原来的video暂停 if (!this.data.indexCurrent) { this.setData({ indexCurrent: curIdx }); const videoContext = wx.createVideoContext(`${curIdx}`, this); //这里对应的视频id videoContext.play(); } else { // 有播放时先将prev暂停，再播放当前点击的current const videoContextPrev = wx.createVideoContext(`${this.data.indexCurrent}`, this); //this是在自定义组件下，当前组件实例的this，以操作组件内 video 组件 if (this.data.indexCurrent !== curIdx) { videoContextPrev.pause(); this.setData({ indexCurrent: curIdx }); const videoContextCurrent = wx.createVideoContext(curIdx, this); videoContextCurrent.play(); } } // 同时要把此时播放的视频记录下来 this.setData({ cover_msg: this.data.cover_msg });} 然后是去获取所有video的dom保存他们距离顶部的距离：
const query = wx.createSelectorQuery(); query.selectAll(&#39;.video-list&#39;).boundingClientRect(rect => { rect.'><meta property="og:type" content="article"><meta property="og:url" content="https://woshidashuaibi-lsj.github.io/blog/video-caikeng/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-05-30T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-30T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="小程序 video 组件踩坑记录"><meta name=twitter:description content='需求是当滑动视窗口的时候，当上一个正在播放的视频消失在视窗的时候，滑动也暂停，将这个视频暂停，同时捕获页面内的视频，播放离顶部最近的视屏。
最开始我这里是做了一个判断进入页面的时候第一个视频自动播放
autoplay="{{key===0?true:false}}" 然后我们需要先做的就是点击播放视频的时候暂停另外一个视频的播放。这里我们需要用到wx.createVideoContext去创造video的实例，控制video的播放和暂停。
indexCurrent: "video_0",// 记录播放的下标 videoPlay(e) { //点击播放时触发 // 当点击其他video播放时让原来的video暂停 if (!this.data.indexCurrent) { this.setData({ indexCurrent: curIdx }); const videoContext = wx.createVideoContext(`${curIdx}`, this); //这里对应的视频id videoContext.play(); } else { // 有播放时先将prev暂停，再播放当前点击的current const videoContextPrev = wx.createVideoContext(`${this.data.indexCurrent}`, this); //this是在自定义组件下，当前组件实例的this，以操作组件内 video 组件 if (this.data.indexCurrent !== curIdx) { videoContextPrev.pause(); this.setData({ indexCurrent: curIdx }); const videoContextCurrent = wx.createVideoContext(curIdx, this); videoContextCurrent.play(); } } // 同时要把此时播放的视频记录下来 this.setData({ cover_msg: this.data.cover_msg });} 然后是去获取所有video的dom保存他们距离顶部的距离：
const query = wx.createSelectorQuery(); query.selectAll(&#39;.video-list&#39;).boundingClientRect(rect => { rect.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://woshidashuaibi-lsj.github.io/blog/"},{"@type":"ListItem","position":2,"name":"小程序 video 组件踩坑记录","item":"https://woshidashuaibi-lsj.github.io/blog/video-caikeng/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"小程序 video 组件踩坑记录","name":"小程序 video 组件踩坑记录","description":"需求是当滑动视窗口的时候，当上一个正在播放的视频消失在视窗的时候，滑动也暂停，将这个视频暂停，同时捕获页面内的视频，播放离顶部最近的视屏。\n最开始我这里是做了一个判断进入页面的时候第一个视频自动播放\nautoplay=\u0026#34;{{key===0?true:false}}\u0026#34; 然后我们需要先做的就是点击播放视频的时候暂停另外一个视频的播放。这里我们需要用到wx.createVideoContext去创造video的实例，控制video的播放和暂停。\nindexCurrent: \u0026#34;video_0\u0026#34;,// 记录播放的下标 videoPlay(e) { //点击播放时触发 // 当点击其他video播放时让原来的video暂停 if (!this.data.indexCurrent) { this.setData({ indexCurrent: curIdx }); const videoContext = wx.createVideoContext(`${curIdx}`, this); //这里对应的视频id videoContext.play(); } else { // 有播放时先将prev暂停，再播放当前点击的current const videoContextPrev = wx.createVideoContext(`${this.data.indexCurrent}`, this); //this是在自定义组件下，当前组件实例的this，以操作组件内 video 组件 if (this.data.indexCurrent !== curIdx) { videoContextPrev.pause(); this.setData({ indexCurrent: curIdx }); const videoContextCurrent = wx.createVideoContext(curIdx, this); videoContextCurrent.play(); } } // 同时要把此时播放的视频记录下来 this.setData({ cover_msg: this.data.cover_msg });} 然后是去获取所有video的dom保存他们距离顶部的距离：\nconst query = wx.createSelectorQuery(); query.selectAll(\u0026#39;.video-list\u0026#39;).boundingClientRect(rect =\u0026gt; { rect.","keywords":["学习"],"articleBody":"需求是当滑动视窗口的时候，当上一个正在播放的视频消失在视窗的时候，滑动也暂停，将这个视频暂停，同时捕获页面内的视频，播放离顶部最近的视屏。\n最开始我这里是做了一个判断进入页面的时候第一个视频自动播放\nautoplay=\"{{key===0?true:false}}\" 然后我们需要先做的就是点击播放视频的时候暂停另外一个视频的播放。这里我们需要用到wx.createVideoContext去创造video的实例，控制video的播放和暂停。\nindexCurrent: \"video_0\",// 记录播放的下标 videoPlay(e) { //点击播放时触发 // 当点击其他video播放时让原来的video暂停 if (!this.data.indexCurrent) { this.setData({ indexCurrent: curIdx }); const videoContext = wx.createVideoContext(`${curIdx}`, this); //这里对应的视频id videoContext.play(); } else { // 有播放时先将prev暂停，再播放当前点击的current const videoContextPrev = wx.createVideoContext(`${this.data.indexCurrent}`, this); //this是在自定义组件下，当前组件实例的this，以操作组件内 video 组件 if (this.data.indexCurrent !== curIdx) { videoContextPrev.pause(); this.setData({ indexCurrent: curIdx }); const videoContextCurrent = wx.createVideoContext(curIdx, this); videoContextCurrent.play(); } } // 同时要把此时播放的视频记录下来 this.setData({ cover_msg: this.data.cover_msg });} 然后是去获取所有video的dom保存他们距离顶部的距离：\nconst query = wx.createSelectorQuery(); query.selectAll('.video-list').boundingClientRect(rect =\u003e { rect.forEach(item =\u003e { console.log(item.top); this.data.videoAllTop.push(item.top); }); }).exec(); 然后重点就是去监听页面的滚动，我们通过监听此时播放的video的top值来判断此时播放的video是否消失，如果消失我们就用滚动的距离scrollTop加上视窗的距离的一半，来判断此时页面滚动的位置然后来播放此时的在页面的距离：\nonPageScroll: tool.debounce(function (e) { const query = wx.createSelectorQuery(); const windowHeight = wx.getSystemInfoSync().windowHeight; const midWindow = e[0].scrollTop + windowHeight / 2; console.log(windowHeight / 2); query.select(`#${this.data.indexCurrent}`).boundingClientRect(rect =\u003e { const bottom = rect.bottom; const top = rect.top; const videoContextPlay = wx.createVideoContext(`${this.data.indexCurrent}`, this); if (bottom \u003c 0) { // 下滑动超出视窗口则暂停该视频同时把滑动的距离加上一半视窗的距离算出大概此时滑动到哪个video下然后播放这个video videoContextPlay.pause(); for (let i = 0; i \u003c this.data.videoLength; i++) { if (midWindow \u003e this.data.videoAllTop[i] \u0026\u0026 midWindow \u003e this.data.videoAllTop[i + 1]) { const videoContextNextPlay = wx.createVideoContext(`video_${i}`); videoContextNextPlay.play(); this.setData({ indexCurrent: `video_${i}` }); } } } if (top \u003e= windowHeight) { // 上滑超出，重新计算新的需要播放的视频 videoContextPlay.pause(); for (let i = 0; i \u003c this.data.videoLength; i++) { if (midWindow \u003e this.data.videoAllTop[i] \u0026\u0026 midWindow \u003e this.data.videoAllTop[i + 1]) { const videoContextNextPlay = wx.createVideoContext(`video_${i}`); videoContextNextPlay.play(); this.setData({ indexCurrent: `video_${i}` }); } } } }).exec(); }), 这里监听页面的滚动我们需要做一个防抖的处理：\nfunction debounce(fn, interval) { let timer; const gapTime = interval || 800; //间隔时间 return function () { clearTimeout(timer); const context = this; const args = arguments; timer = setTimeout(function () { fn.call(context, args); }, gapTime); };} HTML结构：\n\u003cview class=\"video-list\" wx:for=\"{{videoData}}\" wx:for-item=\"item\" wx:for-index=\"key\" wx:key=\"key\"\u003e \u003cvideo class=\"video\" src=\"{{item.videoUrl}}\" enable-play-gesture=\"{{true}}\" show-play-btn=\"{{true}}\" show-center-play-btn=\"{{true}}\" bindpause=\"videoPause\" autoplay=\"{{key===0?true:false}}\" bindplay=\"videoPlay\" bindended=\"videoEnd\" id=\"video_{{key}}\" \u003e \u003cview wx:if=\"{{cover_msg[key]}}\" class=\"msg-time-number\" id='cover'\u003e {{item.weight}}万播放 \u003c/view\u003e \u003c/video\u003e \u003c/view\u003e 总结：\n一开始的时候我是判断下滑超出视频窗口就直接切换到下一个播放，但是这样做如果滚动过快会发生视频的抖动，可能会多个视频一起播放，所以换成这样的方式处理会更好一点。\n———————————-分割线———————————————\n上一版的video还是有很些用户体验不是很好的操作，\n在这前我们是通过判断视频是否消失于视窗口以后在去重新捕获页面中间的视频，然后播放，这就导致有可能一个播放的视频此时其实在视窗口的最下方只出现一点，但是条件判断此时视频没有消失，这给用户的体验是非常不好的，于是重新做了一下滚动那部分的判断，我们直接监听滚动是上滑还是下滑：\nif (e[0].scrollTop \u003e scrollTopTo || e[0].scrollTop \u003e= this.data.scrollHeight) { // 判断时下滑时的操作。 // for (let i = 0; i \u003c this.data.testvideo.length; i++) { for (let i = 0; i \u003c this.data.videoLength; i++) { if (midWindow \u003e this.data.videoAllTop[i] \u0026\u0026 midWindow \u003c this.data.videoAllTop[i + 1] \u0026\u0026 i !== index) { //如果滑动的距离超过一定距离，暂停该视频同时把滑动的距离加上一半视窗的距离算出大概此时滑动到哪个video下然后播放这个video // const videoContextPlay = wx.createVideoContext(`${this.data.indexCurrent}`, this); videoContextPlay.pause(); const videoContextNextPlay = wx.createVideoContext(`video_${i}`); videoContextNextPlay.play(); const coverViewIndex = 'cover_view[' + index + ']'; const coverViewI = 'cover_view[' + i + ']'; this.setData({ [coverViewIndex]: true, [coverViewI]: false, indexCurrent: `video_${i}` }); } } } if (e[0].scrollTop \u003c scrollTopTo) { // 上滑超出，重新计算新的需要播放的视频 // for (let i = 0; i \u003c this.data.testvideo.length; i++) { for (let i = 0; i \u003c this.data.videoLength; i++) { if (midWindow \u003e this.data.videoAllTop[i] \u0026\u0026 midWindow \u003c this.data.videoAllTop[i + 1] \u0026\u0026 i !== index) { videoContextPlay.pause(); const videoContextNextPlay = wx.createVideoContext(`video_${i}`); videoContextNextPlay.play(); const coverViewIndex = 'cover_view[' + index + ']'; const coverViewI = 'cover_view[' + i + ']'; this.setData({ [coverViewIndex]: true, [coverViewI]: false, indexCurrent: `video_${i}` }); } } } scrollTopTo是我们用来记录上一次滚动的距离然后这次滚动的距离做比较来判断是上滑还是下滑，来控制元素的播放。此时再用上之前的防抖就能很好的控制滑动播放窗口之前的视频。但是此时出现了另外一个意向之外的bug，当我点击视频列表中的第二个视频的全屏按钮时，这个视频会突然终止，然后出现第一个视频的声音，经过多次排查后发现是当我们点击放大按钮的时候，是会触发onPageScroll的这个时间，也就是滚动事件，经过打印日志发现，不管你点击哪个视频的全屏按钮都是会触发滚动事件，并且滚动距离为 e[0].scrollTop===0 也就是滚动到最顶部，之前是做了一个滚动到最顶部最上面的时候是播放第一个视频的操作，所以导致就会出现刚在说的无论点击哪个视频的全屏都会触发第一个视频的播放，然后我们就能听到第一个视频播放声音而当前视频暂停。\n因此我在滚动哪里做了一层判断：\nif (e[0].scrollTop === 0 \u0026\u0026 this.scrollTop !== 0) { return; // 点击全屏时iphone端会触发一次滚动时间且e[0].scrollTop为0，所以我们这里需要做一层判断 } 滚动为0的时候不让他触发事件。\n最后是做了一个优化播放视频出错时的状态：就是给视频加了一个蒙层当没有网络或这播放出错时展现的状态：\n\u003cvideo class=\"video\" src=\"{{videoUrl[key]}}\" play-btn-position=\"bottom\" show-play-btn=\"{{true}}\" controls=\"{{!cover_view[key]\u0026\u0026!errorImg[key]}}\" show-center-play-btn=\"{{false}}\" bindpause=\"videoPause\" autoplay=\"{{key===0?true:false}}\" poster=\"{{item.videoCover}}\" bindplay=\"videoPlay\" bindended=\"videoEnd\" bindloadedmetadata=\"loadedmetadata\" id=\"video_{{key}}\" picture-in-picture-show-progress=\"{{true}}\" bindwaiting=\"bindWaiting\" binderror=\"bindError\" bindfullscreenchange=\"fullscreenchange\" objectFit=\"fill\"\u003e \u003cview wx:if=\"{{errorImg[key]}}\"\u003e \u003cview\u003e \u003cview class=\"error-test\"\u003e网络异常，请检查网络\u003c/view\u003e \u003cview bindtap=\"bindRefresh\" class=\"error-btn\" data-id=\"{{key}}\"\u003e重新加载\u003c/view\u003e \u003c/view\u003e \u003c/view\u003e \u003c/video\u003e bindError(e) { // console.log(\"视频播放错误\"); const errorKey = 'errorImg[' + e.target.id.split('_')[1] + ']'; // console.log(this.data.errorImg); this.setData({ [errorKey]: true }); }, 点击重新加载，重置一下src:\nbindRefresh(e) { const videoUrl = 'videoUrl[' + e.target.dataset.id + ']'; this.setData({ [videoUrl]: this.data.videoUrl[e.target.dataset.id], }); //这里重新set一下src的数据 }, 结束——————————————\n","wordCount":"523","inLanguage":"zh","datePublished":"2021-05-30T00:00:00Z","dateModified":"2021-05-30T00:00:00Z","author":{"@type":"Person","name":"卢穗杰"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://woshidashuaibi-lsj.github.io/blog/video-caikeng/"},"publisher":{"@type":"Organization","name":"lusuijie","logo":{"@type":"ImageObject","url":"https://woshidashuaibi-lsj.github.io/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/style.css><link rel=stylesheet href=/css/main.min.ec28f09e946fc0df77c187fcd0d0ebde58fca6de8efb8e1620f3d45c32d4da88.css integrity="sha256-7CjwnpRvwN93wYf80NDr3lj8pt6O+44WIPPUXDLU2og=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>主页
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/blog>文章</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>分类</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>历史文章</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>留言板</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/woshidashuaibi-lsj><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>小程序 video 组件踩坑记录</h1></header><p><small>2021年5月30日&nbsp;· 523 字&nbsp;· 3 分钟</small><p><div class=blog-toc><nav id=TableOfContents></nav></div><section class=blog-content><p>需求是当滑动视窗口的时候，当上一个正在播放的视频消失在视窗的时候，滑动也暂停，将这个视频暂停，同时捕获页面内的视频，播放离顶部最近的视屏。</p><p>最开始我这里是做了一个判断进入页面的时候第一个视频自动播放</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>autoplay</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{key===0?true:false}}&#34;</span>
</span></span></code></pre></div><p>然后我们需要先做的就是点击播放视频的时候暂停另外一个视频的播放。这里我们需要用到wx.createVideoContext去创造video的实例，控制video的播放和暂停。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>indexCurrent</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;video_0&#34;</span>,<span style=color:#75715e>// 记录播放的下标
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>videoPlay</span>(<span style=color:#a6e22e>e</span>) {   <span style=color:#75715e>//点击播放时触发
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 当点击其他video播放时让原来的video暂停   
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>indexCurrent</span>) {     
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({ <span style=color:#a6e22e>indexCurrent</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>curIdx</span> });    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>videoContext</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createVideoContext</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>curIdx</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#66d9ef>this</span>); 
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这里对应的视频id   
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>videoContext</span>.<span style=color:#a6e22e>play</span>();  
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> { 
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 有播放时先将prev暂停，再播放当前点击的current    
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>videoContextPrev</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createVideoContext</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>indexCurrent</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>//this是在自定义组件下，当前组件实例的this，以操作组件内 video 组件   
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>indexCurrent</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>curIdx</span>) { 
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>videoContextPrev</span>.<span style=color:#a6e22e>pause</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({   <span style=color:#a6e22e>indexCurrent</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>curIdx</span>   });
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>videoContextCurrent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createVideoContext</span>(<span style=color:#a6e22e>curIdx</span>, <span style=color:#66d9ef>this</span>);  
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>videoContextCurrent</span>.<span style=color:#a6e22e>play</span>();      
</span></span><span style=display:flex><span>    }    
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 同时要把此时播放的视频记录下来
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({      <span style=color:#a6e22e>cover_msg</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>cover_msg</span>    });}
</span></span></code></pre></div><p>然后是去获取所有video的dom保存他们距离顶部的距离：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createSelectorQuery</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>selectAll</span>(<span style=color:#e6db74>&#39;.video-list&#39;</span>).<span style=color:#a6e22e>boundingClientRect</span>(<span style=color:#a6e22e>rect</span> =&gt; {      
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rect</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>item</span> =&gt; {        
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>top</span>);        
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoAllTop</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>top</span>);      
</span></span><span style=display:flex><span>    });    
</span></span><span style=display:flex><span>  }).<span style=color:#a6e22e>exec</span>();
</span></span></code></pre></div><p>然后重点就是去监听页面的滚动，我们通过监听此时播放的video的top值来判断此时播放的video是否消失，如果消失我们就用滚动的距离scrollTop加上视窗的距离的一半，来判断此时页面滚动的位置然后来播放此时的在页面的距离：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>onPageScroll</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>debounce</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>e</span>) {    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createSelectorQuery</span>();    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>windowHeight</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>getSystemInfoSync</span>().<span style=color:#a6e22e>windowHeight</span>;    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>midWindow</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>scrollTop</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>windowHeight</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>windowHeight</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>);    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>select</span>(<span style=color:#e6db74>`#</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>indexCurrent</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>).<span style=color:#a6e22e>boundingClientRect</span>(<span style=color:#a6e22e>rect</span> =&gt; {      
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bottom</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rect</span>.<span style=color:#a6e22e>bottom</span>;      
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>top</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rect</span>.<span style=color:#a6e22e>top</span>;      
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>videoContextPlay</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createVideoContext</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>indexCurrent</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#66d9ef>this</span>);      
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>bottom</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {        
</span></span><span style=display:flex><span>      <span style=color:#75715e>// 下滑动超出视窗口则暂停该视频同时把滑动的距离加上一半视窗的距离算出大概此时滑动到哪个video下然后播放这个video        
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>videoContextPlay</span>.<span style=color:#a6e22e>pause</span>();        
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoLength</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {          
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>midWindow</span> <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoAllTop</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>midWindow</span> <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoAllTop</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]) {            
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>videoContextNextPlay</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createVideoContext</span>(<span style=color:#e6db74>`video_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);            
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>videoContextNextPlay</span>.<span style=color:#a6e22e>play</span>();            
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({              
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>indexCurrent</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`video_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>            
</span></span><span style=display:flex><span>            });          
</span></span><span style=display:flex><span>          }        
</span></span><span style=display:flex><span>        }      
</span></span><span style=display:flex><span>      }      
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>top</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>windowHeight</span>) {        
</span></span><span style=display:flex><span>              <span style=color:#75715e>// 上滑超出，重新计算新的需要播放的视频        
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>              <span style=color:#a6e22e>videoContextPlay</span>.<span style=color:#a6e22e>pause</span>();        
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoLength</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {          
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>midWindow</span> <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoAllTop</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>midWindow</span> <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoAllTop</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]) {            
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>videoContextNextPlay</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createVideoContext</span>(<span style=color:#e6db74>`video_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);            
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>videoContextNextPlay</span>.<span style=color:#a6e22e>play</span>();            
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({              
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>indexCurrent</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`video_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>            
</span></span><span style=display:flex><span>                  });          
</span></span><span style=display:flex><span>                }        
</span></span><span style=display:flex><span>              }      
</span></span><span style=display:flex><span>            }    
</span></span><span style=display:flex><span>          }).<span style=color:#a6e22e>exec</span>();  
</span></span><span style=display:flex><span>        }),
</span></span></code></pre></div><p>这里监听页面的滚动我们需要做一个防抖的处理：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>debounce</span>(<span style=color:#a6e22e>fn</span>, <span style=color:#a6e22e>interval</span>) {    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>timer</span>;    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>gapTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>interval</span> <span style=color:#f92672>||</span> <span style=color:#ae81ff>800</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>//间隔时间    
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>function</span> () {        
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clearTimeout</span>(<span style=color:#a6e22e>timer</span>);        
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>;        
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>args</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>arguments</span>;        
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>timer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setTimeout</span>(<span style=color:#66d9ef>function</span> () {            
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fn</span>.<span style=color:#a6e22e>call</span>(<span style=color:#a6e22e>context</span>, <span style=color:#a6e22e>args</span>);        
</span></span><span style=display:flex><span>      }, <span style=color:#a6e22e>gapTime</span>);    
</span></span><span style=display:flex><span>    };}
</span></span></code></pre></div><p>HTML结构：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>view</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;video-list&#34;</span> <span style=color:#a6e22e>wx:for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{videoData}}&#34;</span> <span style=color:#a6e22e>wx:for-item</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item&#34;</span> <span style=color:#a6e22e>wx:for-index</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;key&#34;</span> <span style=color:#a6e22e>wx:key</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;key&#34;</span>&gt;       
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>video</span>             
</span></span><span style=display:flex><span><span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;video&#34;</span>             
</span></span><span style=display:flex><span><span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{item.videoUrl}}&#34;</span>            
</span></span><span style=display:flex><span><span style=color:#a6e22e>enable-play-gesture</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{true}}&#34;</span>            
</span></span><span style=display:flex><span><span style=color:#a6e22e>show-play-btn</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{true}}&#34;</span>           
</span></span><span style=display:flex><span> <span style=color:#a6e22e>show-center-play-btn</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{true}}&#34;</span>            
</span></span><span style=display:flex><span> <span style=color:#a6e22e>bindpause</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;videoPause&#34;</span>             
</span></span><span style=display:flex><span> <span style=color:#a6e22e>autoplay</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{key===0?true:false}}&#34;</span>            
</span></span><span style=display:flex><span> <span style=color:#a6e22e>bindplay</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;videoPlay&#34;</span>             
</span></span><span style=display:flex><span> <span style=color:#a6e22e>bindended</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;videoEnd&#34;</span>            
</span></span><span style=display:flex><span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;video_{{key}}&#34;</span>        
</span></span><span style=display:flex><span> &gt;            
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>view</span> <span style=color:#a6e22e>wx:if</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{cover_msg[key]}}&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;msg-time-number&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;cover&#39;</span>&gt;                
</span></span><span style=display:flex><span>  {{item.weight}}万播放            
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>view</span>&gt;              
</span></span><span style=display:flex><span> &lt;/<span style=color:#f92672>video</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>view</span>&gt;
</span></span></code></pre></div><p>总结：</p><p>一开始的时候我是判断下滑超出视频窗口就直接切换到下一个播放，但是这样做如果滚动过快会发生视频的抖动，可能会多个视频一起播放，所以换成这样的方式处理会更好一点。</p><p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-分割线&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</p><p>上一版的video还是有很些用户体验不是很好的操作，</p><p>在这前我们是通过判断视频是否消失于视窗口以后在去重新捕获页面中间的视频，然后播放，这就导致有可能一个播放的视频此时其实在视窗口的最下方只出现一点，但是条件判断此时视频没有消失，这给用户的体验是非常不好的，于是重新做了一下滚动那部分的判断，我们直接监听滚动是上滑还是下滑：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>scrollTop</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>scrollTopTo</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>scrollTop</span> <span style=color:#f92672>&gt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>scrollHeight</span>) {          
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 判断时下滑时的操作。          
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// for (let i = 0; i &lt; this.data.testvideo.length; i++) {          
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoLength</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {            
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>midWindow</span> <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoAllTop</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>midWindow</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoAllTop</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>index</span>) {              
</span></span><span style=display:flex><span>        <span style=color:#75715e>//如果滑动的距离超过一定距离，暂停该视频同时把滑动的距离加上一半视窗的距离算出大概此时滑动到哪个video下然后播放这个video              
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// const videoContextPlay = wx.createVideoContext(`${this.data.indexCurrent}`, this);              
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>videoContextPlay</span>.<span style=color:#a6e22e>pause</span>();              
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>videoContextNextPlay</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createVideoContext</span>(<span style=color:#e6db74>`video_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);              
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>videoContextNextPlay</span>.<span style=color:#a6e22e>play</span>();              
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>coverViewIndex</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;cover_view[&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;]&#39;</span>;              
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>coverViewI</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;cover_view[&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;]&#39;</span>;              
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({                
</span></span><span style=display:flex><span>          [<span style=color:#a6e22e>coverViewIndex</span>]<span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,                
</span></span><span style=display:flex><span>          [<span style=color:#a6e22e>coverViewI</span>]<span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,                
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>indexCurrent</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`video_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>              
</span></span><span style=display:flex><span>        });            
</span></span><span style=display:flex><span>      }          
</span></span><span style=display:flex><span>    }        
</span></span><span style=display:flex><span>  }        
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>scrollTop</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>scrollTopTo</span>) {          
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 上滑超出，重新计算新的需要播放的视频          
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// for (let i = 0; i &lt; this.data.testvideo.length; i++) {          
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoLength</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {            
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>midWindow</span> <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoAllTop</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>midWindow</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoAllTop</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>index</span>) {              
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>videoContextPlay</span>.<span style=color:#a6e22e>pause</span>();              
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>videoContextNextPlay</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>createVideoContext</span>(<span style=color:#e6db74>`video_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);              
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>videoContextNextPlay</span>.<span style=color:#a6e22e>play</span>();              
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>coverViewIndex</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;cover_view[&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;]&#39;</span>;              
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>coverViewI</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;cover_view[&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;]&#39;</span>;              
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({                
</span></span><span style=display:flex><span>            [<span style=color:#a6e22e>coverViewIndex</span>]<span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,                
</span></span><span style=display:flex><span>            [<span style=color:#a6e22e>coverViewI</span>]<span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,                
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>indexCurrent</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`video_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>              
</span></span><span style=display:flex><span>          });            
</span></span><span style=display:flex><span>        }          
</span></span><span style=display:flex><span>      }        
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>scrollTopTo是我们用来记录上一次滚动的距离然后这次滚动的距离做比较来判断是上滑还是下滑，来控制元素的播放。此时再用上之前的防抖就能很好的控制滑动播放窗口之前的视频。但是此时出现了另外一个意向之外的bug，当我点击视频列表中的第二个视频的全屏按钮时，这个视频会突然终止，然后出现第一个视频的声音，经过多次排查后发现是当我们点击放大按钮的时候，是会触发onPageScroll的这个时间，也就是滚动事件，经过打印日志发现，不管你点击哪个视频的全屏按钮都是会触发滚动事件，并且滚动距离为 e[0].scrollTop===0 也就是滚动到最顶部，之前是做了一个滚动到最顶部最上面的时候是播放第一个视频的操作，所以导致就会出现刚在说的无论点击哪个视频的全屏都会触发第一个视频的播放，然后我们就能听到第一个视频播放声音而当前视频暂停。</p><p>因此我在滚动哪里做了一层判断：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>scrollTop</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>scrollTop</span> <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>) {        
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span>; 
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 点击全屏时iphone端会触发一次滚动时间且e[0].scrollTop为0，所以我们这里需要做一层判断      
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span></code></pre></div><p>滚动为0的时候不让他触发事件。</p><p>最后是做了一个优化播放视频出错时的状态：就是给视频加了一个蒙层当没有网络或这播放出错时展现的状态：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>video</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;video&#34;</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{videoUrl[key]}}&#34;</span> <span style=color:#a6e22e>play-btn-position</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bottom&#34;</span> <span style=color:#a6e22e>show-play-btn</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{true}}&#34;</span> <span style=color:#a6e22e>controls</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{!cover_view[key]&amp;&amp;!errorImg[key]}}&#34;</span> <span style=color:#a6e22e>show-center-play-btn</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{false}}&#34;</span> <span style=color:#a6e22e>bindpause</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;videoPause&#34;</span> <span style=color:#a6e22e>autoplay</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{key===0?true:false}}&#34;</span> <span style=color:#a6e22e>poster</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{item.videoCover}}&#34;</span> <span style=color:#a6e22e>bindplay</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;videoPlay&#34;</span> <span style=color:#a6e22e>bindended</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;videoEnd&#34;</span> <span style=color:#a6e22e>bindloadedmetadata</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;loadedmetadata&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;video_{{key}}&#34;</span> <span style=color:#a6e22e>picture-in-picture-show-progress</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{true}}&#34;</span> <span style=color:#a6e22e>bindwaiting</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bindWaiting&#34;</span> <span style=color:#a6e22e>binderror</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bindError&#34;</span> <span style=color:#a6e22e>bindfullscreenchange</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fullscreenchange&#34;</span> <span style=color:#a6e22e>objectFit</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fill&#34;</span>&gt;            
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>view</span> <span style=color:#a6e22e>wx:if</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{errorImg[key]}}&#34;</span>&gt;                
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>view</span>&gt;                    
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>view</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;error-test&#34;</span>&gt;网络异常，请检查网络&lt;/<span style=color:#f92672>view</span>&gt;                    
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>view</span> <span style=color:#a6e22e>bindtap</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bindRefresh&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;error-btn&#34;</span> <span style=color:#a6e22e>data-id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{key}}&#34;</span>&gt;重新加载&lt;/<span style=color:#f92672>view</span>&gt;                
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>view</span>&gt;                
</span></span><span style=display:flex><span>  <span style=color:#75715e>&lt;!--  --&gt;</span>            
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>view</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>video</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span> <span style=color:#a6e22e>bindError</span>(<span style=color:#a6e22e>e</span>) {    
</span></span><span style=display:flex><span>  <span style=color:#75715e>// console.log(&#34;视频播放错误&#34;);    
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>errorKey</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;errorImg[&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>id</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;_&#39;</span>)[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;]&#39;</span>;    
</span></span><span style=display:flex><span>  <span style=color:#75715e>// console.log(this.data.errorImg);    
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({      
</span></span><span style=display:flex><span>    [<span style=color:#a6e22e>errorKey</span>]<span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>    
</span></span><span style=display:flex><span>    });  
</span></span><span style=display:flex><span>  },
</span></span></code></pre></div><p>点击重新加载，重置一下src:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>bindRefresh</span>(<span style=color:#a6e22e>e</span>) {    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>videoUrl</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;videoUrl[&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>dataset</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;]&#39;</span>;    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({      
</span></span><span style=display:flex><span>    [<span style=color:#a6e22e>videoUrl</span>]<span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>videoUrl</span>[<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>dataset</span>.<span style=color:#a6e22e>id</span>],    
</span></span><span style=display:flex><span>    });    
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这里重新set一下src的数据  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  },
</span></span></code></pre></div><p>结束&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</p></section><div class=paginator><a class=prev href=https://woshidashuaibi-lsj.github.io/blog/chrome-devtools/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>Chrome DevTools 快速入门</span></a>
<a class=next href=https://woshidashuaibi-lsj.github.io/blog/riji-liulanqi-anquan/><span>由前端网络安全到http，https和浏览器的存储（个人笔记）</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div><div class=comments><script>const getTheme=window.localStorage&&window.localStorage.getItem("theme");let theme=getTheme==="dark"?"dark":"light",s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","woshidashuaibi-lsj/lusuijie.github.io"),s.setAttribute("data-repo-id","R_kgDOLUkL3w"),s.setAttribute("data-category","Announcements"),s.setAttribute("data-category-id","DIC_kwDOLUkL384CdVmA"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","top"),s.setAttribute("data-theme",theme),s.setAttribute("data-lang","en"),s.setAttribute("data-loading","lazy"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://woshidashuaibi-lsj.github.io/>lusuijie</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>